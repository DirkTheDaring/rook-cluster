- block:
    # kubectl -n {{ storage1_namespace }} get secret rook-ceph-dashboard-password -o custom-columns=password:data.password --no-headers
  - name: get current argocd password and store it
    ansible.builtin.command:
      argv:
      - kubectl
      - --namespace
      - "{{ storage1_namespace }}"
      - get
      - secret
      - rook-ceph-dashboard-password
      - -o
      - custom-columns=password:data.password
      - --no-headers
    register: storage1_credential_result

  - name: extract password
    set_fact:
      storage1_password: "{{ storage1_credential_result.stdout | b64decode }}"
      storage1_username: "admin"
      storage1_url:      "https://{{ storage1_fqdn }}"

  - name: Create a directory if it does not exist
    ansible.builtin.file:
      path: "{{ storage1_credentials_dir }}"
      state: directory
      mode: '0700'

  - name: Create web.json
    template:
      src: "web.json.jinja2"
      dest: "{{ storage1_credentials_dir }}/web.json"

  when: storage1_ceph_server
