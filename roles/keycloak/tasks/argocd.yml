- name: debug
  ansible.builtin.template:
    src:  application.yaml.jinja2
    dest: /tmp/keycloak-application.yml

- name: create application
  kubernetes.core.k8s:
    template: application.yaml.jinja2

- name: wait until application status turns to synced in argocd
  ansible.builtin.command: 
    argv:
    - bash 
    - -c
    - "while [[ \"$(kubectl -n {{ keycloak_argocd_namespace }} get application {{ keycloak_chart_release_name | default('keycloak') }} -o custom-columns=status:status.sync.status --no-headers)\" != \"Synced\" ]]; do sleep 3; done"
