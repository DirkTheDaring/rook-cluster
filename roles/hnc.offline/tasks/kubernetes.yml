- name: apply labels
  ansible.builtin.command: 
    argv:
    -  bash 
    - -c
    - "kubectl label ns {{ item }} hnc.x-k8s.io/excluded-namespace=true --overwrite"
  loop:
  - kube-system
  - kube-public
  - kube-node-lease

- name:  build url to operator
  set_fact:
    hnc_operator_url: "https://github.com/kubernetes-sigs/multi-tenancy/releases/download/{{ hnc_release }}/hnc-manager.yaml"

- name: apply operator
  ansible.builtin.command: 
    argv:
    -  bash 
    - -c
    - "kubectl apply -f {{ hnc_operator_url }}"

#- name: Download metrics-server manifest to the cluster.
#  ansible.builtin.get_url:
#    url: "{{ hnc_operator_url }}" 
#    dest: ~/metrics-server.yaml
#    mode: '0664'
#
#
#- name: apply operator
#  kubernetes.core.k8s:
#    src: "{{ hnc_operator_url }}"
#    state: present
#    apply: yes 
